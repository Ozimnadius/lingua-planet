
// common.js
function getNumber(str) {
    return parseInt(str.replace(/\s/g, ''));
}

function number_format(number, decimals, dec_point, thousands_sep) {
    var i, j, kw, kd, km;
    if (isNaN(decimals = Math.abs(decimals))) {
        decimals = 2;
    }
    if (dec_point == undefined) {
        dec_point = ",";
    }
    if (thousands_sep == undefined) {
        thousands_sep = ".";
    }
    i = parseInt(number = (+number || 0).toFixed(decimals)) + "";
    if ((j = i.length) > 3) {
        j = j % 3;
    } else {
        j = 0;
    }
    km = (j ? i.substr(0, j) + thousands_sep : "");
    kw = i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + thousands_sep);
    kd = (decimals ? dec_point + Math.abs(number - i).toFixed(decimals).replace(/-/, 0).slice(2) : "");
    return km + kw + kd;
}

function imageResize(src) {
    $('img').not('.logo__img').attr('src', src);
}
// imageResize('https://loremflickr.com/320/440');

const wWidth = $(window).width();

function initParams(item, slider) {

    let params = item.params,
        data = slider.dataset,
        speed = parseInt(data.speed) || 300,
        autoplay = (data.autoplay == 'true'),
        delay = parseInt(data.autoplayDelay) || 5000,
        pagination = (data.pagination == 'true');

    params.speed = speed;

    if (autoplay) {
        params.autoplay.enabled = autoplay;
        params.autoplay.delay = delay;
    }


    if (!pagination) {
        params.pagination = {};
    }
}
//index.js
$(function () {
    const banner = document.querySelector('.banner__slider');
    if (banner) {
        let bannerSwiper = new Swiper(banner, {
            slidesPerView: 1,
            effect: 'slide',
            loop: true,
            watchOverflow: true,
            // Navigation arrows
            navigation: {
                nextEl: '.banner__next',
                prevEl: '.banner__prev',
            },
            // If we need pagination
            pagination: {
                el: '.banner__pag',
                clickable: true
            },
            on: {
                init: function () {
                    initParams(this, banner);
                },
            },
        });
    }

    $('select').styler();

    let offersSwiper = new Swiper('.offers__swiper', {
        slidesPerView: 1.15,
        spaceBetween: 10,
        watchOverflow: true,
        centeredSlides: false,
        loop: true,
        // Navigation arrows
        navigation: {
            nextEl: '.offers__next',
            prevEl: '.offers__prev',
        },
        breakpoints: {
            // when window width is >= 768px
            768: {
                slidesPerView: 2,
                spaceBetween: 20,
                centeredSlides: false,
            },
            // when window width is >= 1200px
            1200: {
                slidesPerView: 4,
                spaceBetween: 20,
                centeredSlides: true,
            }
        }
    });

    let revsSwiper = new Swiper('.revs__swiper', {
        slidesPerView: 1.2,
        spaceBetween: 10,
        watchOverflow: true,
        // Navigation arrows
        navigation: {
            nextEl: '.revs__next',
            prevEl: '.revs__prev',
        },
        breakpoints: {
            // when window width is >= 768px
            768: {
                slidesPerView: 1.8,
                spaceBetween: 20,
            },
            // when window width is >= 1200px
            1200: {
                slidesPerView: 3,
                spaceBetween: 30,
            }
        }
    });

    $('input[type=tel]').mask('+7 (999) 999-99-99');

});
//catlog.js
$(function () {


});
//product.js
$(function () {

    // VARIABLES


    // EVENTS


    // FUNCTIONS


    //VENDORS
    var galleryThumbs = new Swiper('.pthumbs', {
        spaceBetween: -1,
        slidesPerView: 4,
        watchSlidesVisibility: true,
        watchSlidesProgress: true,
        grabCursor: true,
        breakpoints: {
            // when window width is >= 769px
            768: {
                slidesPerView: 4,
            },
            // when window width is >= 992px
            992: {
                slidesPerView: 4,
            },
        },
    });

    var galleryTop = new Swiper('.pslider', {
        navigation: {
            nextEl: '.product__next',
            prevEl: '.product__prev',
        },
        thumbs: {
            swiper: galleryThumbs
        }
    });

    var galleryThumbs2 = new Swiper('.pthumbs2', {
        spaceBetween: 10,
        slidesPerView: 4,
        watchSlidesVisibility: true,
        watchSlidesProgress: true,
        grabCursor: true,
        breakpoints: {
            // when window width is >= 769px
            768: {
                slidesPerView: 6,
                spaceBetween: 15,

            },
            // when window width is >= 992px
            992: {
                slidesPerView: 6,
                spaceBetween: 20,
            },
        }
    });

    var galleryTop2 = new Swiper('.pgallery__container', {
        navigation: {
            nextEl: '.pgallery__next',
            prevEl: '.pgallery__prev',
        },
        thumbs: {
            swiper: galleryThumbs2
        }
    });

    let tabs = new Tabs('.ptabs')

});

class Tabs{
    constructor(selector) {
        this.tabs = document.querySelector(selector);
        this.items = this.tabs.querySelectorAll('.ptabs__item');
        this.swList = this.tabs.querySelectorAll('.ptabs__sw');
        this.activeIndex = 0;

       this.#init();
    }

    #init(){
        this.swList.forEach(sw=>{
            sw.addEventListener('click', (e)=>{
                let btn = e.currentTarget
                let x = [...this.swList].findIndex(i=>i==btn);

                if (this.activeIndex == x) {
                    return;
                }

                this.hide();
                this.activeIndex = x;
                this.show();
                this.setHeight();

            });
        });

        this.setHeight();
    }

    get activeItem(){
        return this.items[this.activeIndex]
    }

    show(){
        this.activeItem.classList.add('active');
    }

    hide(){
        this.activeItem.classList.remove('active');
    }

    setHeight(){
        let swHeight = this.swList[0].offsetHeight;
        let tabHeight = this.activeItem.querySelector('.ptabs__tab').offsetHeight;
        this.tabs.style.height = swHeight+tabHeight+'px';
    }
}